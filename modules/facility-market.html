<!doctype html><html lang='ar' dir='rtl'><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width,initial-scale=1'/><title>سوق المرافق — حصيف</title><link rel='stylesheet' href='../assets/css/style.css'/><link rel='stylesheet' href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'/><script src='https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'></script></head><body><div class='container' id='wrap'><h2>سوق المرافق</h2><div class='toolbar'><input class='input' id='q' placeholder='ابحث باسم المرفق/المدينة'/><button class='btn' onclick='doFilter()'>بحث</button><button class='btn secondary' onclick='exportCSV()'>CSV</button><button class='btn' onclick="util.pdf('سوق_المرافق','#wrap')">PDF</button></div><div id='map'></div><div id='cards' class='grid grid-3' style='margin-top:12px'></div></div><script src='../assets/js/util.js'></script><script>let data=[];let markers=[];const map=L.map('map').setView([23.8859,45.0792],5);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18}).addTo(map);function render(list){const wrap=document.getElementById('cards');wrap.innerHTML='';markers.forEach(m=>map.removeLayer(m));markers=[];list.forEach((x,i)=>{const el=document.createElement('div');el.className='card';el.innerHTML=`<img src='${x.img}' style='width:100%;height:180px;object-fit:cover;border-radius:8px'><h3>${x.name}</h3><div class='kpi'><span class='num'>${x.cap}</span><span class='lbl'>مقعد</span></div><div class='muted'>${x.city}</div><div class='toolbar'><a class='btn' href='facility.html?i=${i}'>عرض التفاصيل</a><button class='btn secondary' onclick="alert('تم إرسال طلب الحجز')">طلب حجز</button></div>`;wrap.appendChild(el);markers.push(L.marker([x.lat,x.lng]).addTo(map).bindPopup(`<b>${x.name}</b><br>${x.city}`));});}function doFilter(){const q=document.getElementById('q').value.trim().toLowerCase();render(data.filter(d=>(d.name+d.city).toLowerCase().includes(q)));}function exportCSV(){const hdr=['الاسم','المدينة','السعة','السعر','lat','lng'];const arr=data.map(d=>[d.name,d.city,d.cap,d.price,d.lat,d.lng]);util.download('facilities.csv', util.toCSV([hdr,...arr]));}fetch('../assets/data/facilities.json').then(r=>r.json()).then(arr=>{data=arr;render(data);});</script></body></html>